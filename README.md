# nrf52840-esb-prx

–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è **nRF52840 SuperMini**, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π —Ä–∞–±–æ—Ç—É **Enhanced ShockBurst (ESB)** –æ—Ç Nordic Semiconductor –≤ —Ä–µ–∂–∏–º–µ **PRX (Primary Receiver)**.

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø—Ä–∏—ë–º–∞ –ø–∞–∫–µ—Ç–æ–≤ –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ —Ä–µ–∂–∏–º–µ **PTX** –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é —Å–≤–µ—Ç–æ–¥–∏–æ–¥–æ–≤, –∞ —Ç–∞–∫–∂–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ `NRF_LOG`.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
nrf52840-esb-prx
‚îú‚îÄ‚îÄ armgcc
‚îÇ   ‚îú‚îÄ‚îÄ esb_prx_gcc_nrf52.ld     # Linker script
‚îÇ   ‚îî‚îÄ‚îÄ Makefile                 # –°–±–æ—Ä–∫–∞ –∏ –ø—Ä–æ—à–∏–≤–∫–∞
‚îú‚îÄ‚îÄ config
‚îÇ   ‚îú‚îÄ‚îÄ custom_board.h           # –û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞—Ç—ã (SuperMini)
‚îÇ   ‚îú‚îÄ‚îÄ nrf52840_mdk.h
‚îÇ   ‚îî‚îÄ‚îÄ sdk_config.h             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SDK
‚îú‚îÄ‚îÄ hex                          # –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∫–∏ (.hex)
‚îî‚îÄ‚îÄ main.c                       # –ü—Ä–∏–º–µ—Ä ESB PRX
```

---

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

* nRF52840 SuperMini
* ARM GCC toolchain
* `make`
* `pyocd`
* **nRF5 SDK 17.1.0**

---

## üì¶ Nordic SDK

–°–∫–∞—á–∞–π—Ç–µ **nRF5 SDK 17.1.0** —Å —Å–∞–π—Ç–∞ Nordic Semiconductor –∏ —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ SDK –≤ `armgcc/Makefile`:

```makefile
SDK_ROOT := /Users/nick/projects/iot/nRF5_SDK_17.1.0_ddde560/
```

> ‚ö†Ô∏è –ü—É—Ç—å –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –∫–æ—Ä–µ–Ω—å SDK

---

## ‚öôÔ∏è –°–±–æ—Ä–∫–∞ –∏ –ø—Ä–æ—à–∏–≤–∫–∞

```bash
cd armgcc
make
make flash
```

–ü–æ—Å–ª–µ –ø—Ä–æ—à–∏–≤–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∂–∏–º –ø—Ä–∏—ë–º–∞.

---

## üì° –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç **ESB PRX** (–ø—Ä–∏—ë–º–Ω–∏–∫):

* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Enhanced ShockBurst —Å Dynamic Payload Length**
* –°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞—á–∏: **2 Mbps**
* Auto-ACK –≤–∫–ª—é—á—ë–Ω
* –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ RX
* –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–∞–∫–µ—Ç–∞:

  * –¥–∞–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ RX FIFO
  * —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–≤–µ—Ç–æ–¥–∏–æ–¥–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å PTX
  * –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –ª–æ–≥

–û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–≥–∞—é—â–∏–π:

* –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–≥–æ–≤
* –æ–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π —á–µ—Ä–µ–∑ `__WFE()`

---

## üß† –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ESB

```c
nrf_esb_config.protocol = NRF_ESB_PROTOCOL_ESB_DPL;
nrf_esb_config.bitrate  = NRF_ESB_BITRATE_2MBPS;
nrf_esb_config.mode     = NRF_ESB_MODE_PRX;
nrf_esb_config.payload_length = 8;
nrf_esb_config.selective_auto_ack = false;
```

–ê–¥—Ä–µ—Å–∞ –∏ –ø—Ä–µ—Ñ–∏–∫—Å—ã **–¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å PTX**:

```c
base_addr_0 = { 0xE7, 0xE7, 0xE7, 0xE7 }
base_addr_1 = { 0xC2, 0xC2, 0xC2, 0xC2 }

prefixes = { 0xE7, 0xC2, 0xC3, 0xC4, 0xC5, 0xC6, 0xC7, 0xC8 }
```

---

## üì• –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π ESB

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫:

* `NRF_ESB_EVENT_RX_RECEIVED` ‚Äî –ø—Ä–∏—ë–º –ø–∞–∫–µ—Ç–∞
* `NRF_ESB_EVENT_TX_SUCCESS` ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ACK
* `NRF_ESB_EVENT_TX_FAILED` ‚Äî –æ—à–∏–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏ ACK

–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:

* —á–∏—Ç–∞–µ—Ç—Å—è `rx_payload`
* –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è `rx_payload.data[1]`
* —Å–≤–µ—Ç–æ–¥–∏–æ–¥—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—Ç—á–∏–∫–∞

---

## üî¶ –ò–Ω–¥–∏–∫–∞—Ü–∏—è

–°–≤–µ—Ç–æ–¥–∏–æ–¥—ã **–ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–≤—Ç–æ—Ä—è—é—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ PTX**, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ä–∞–¥–∏–æ.

```c
rx_payload.data[1]
```

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Å—á—ë—Ç—á–∏–∫ –∏ —à–∞–±–ª–æ–Ω –∏–Ω–¥–∏–∫–∞—Ü–∏–∏.

---

## ‚ö° –≠–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ

–í –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

```c
__WFE();
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

* –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ
* –ø—Ä–æ—Å—ã–ø–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø–æ —Å–æ–±—ã—Ç–∏—è–º ESB –∏–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üß™ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å PTX

–î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ç—Ä–µ–±—É–µ—Ç—Å—è:

* –æ–¥–∏–Ω nRF52840 –≤ —Ä–µ–∂–∏–º–µ **PTX**
* –æ–¥–∏–Ω nRF52840 –≤ —Ä–µ–∂–∏–º–µ **PRX**
* –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ:

  * –∞–¥—Ä–µ—Å–∞ ESB
  * bitrate
  * protocol
  * payload format
